<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You vs Bot - Law Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <style>
        .score-tracker {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
        }
        .score-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: var(--warm-beige);
            border: 2px solid var(--border-walnut);
            min-width: 100px;
        }
        .score-label {
            font-size: 14px;
            color: var(--text-parchment);
            margin-bottom: 5px;
        }
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-walnut);
        }
        .ai-answer-section, .user-answer-section {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .ai-answer-section {
            background: var(--warm-beige);
            border-left-color: var(--secondary-brass);
        }
        .user-answer-section.correct {
            background: #fef9c3;
            border-left-color: #fde047;
        }
        .user-answer-section.incorrect {
            background: #fee2e2;
            border-left-color: #f87171;
        }
        .vs-indicator {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary-walnut);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb">
            <a href="{{ url_for('index') }}" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">›</span>
            <a href="{{ url_for('mode_select') }}" class="breadcrumb-item">Game Modes</a>
            <span class="breadcrumb-separator">›</span>
            <span class="breadcrumb-item active">You vs Bot</span>
        </nav>
        
<div class="header">
            <h1>You vs Bot</h1>
            <p>Test your legal knowledge against AI</p>
            
            {% if user_score is defined and bot_score is defined %}
            <div class="score-tracker">
                <div class="score-item user-score">
                    <h4>You</h4>
                    <div class="score-number">{{ user_score }}</div>
                </div>
                <div class="score-vs">VS</div>
                <div class="score-item bot-score">
                    <h4>Bot</h4>
                    <div class="score-number">{{ bot_score }}</div>
                </div>
            </div>
            {% endif %}
            
            <div class="header-links">
                <a href="{{ url_for('bot_mode') }}" class="btn btn-secondary" title="Start New Session">New Session</a>
                <a href="{{ url_for('mode_select') }}" class="btn btn-secondary">Back to Modes</a>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
            </div>
        </div>
            </div>
            <div class="header-links">
                <a href="{{ url_for('bot_mode') }}" class="btn btn-secondary" title="Start New Session">New Session</a>
                <a href="{{ url_for('mode_select') }}" class="btn btn-secondary">Back to Modes</a>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
            </div>
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash-messages">
                    {% for message in messages %}
                        <div class="flash-message">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- Session Progress -->
        {% if session_data %}
        <div class="progress-container">
            <h3>Session Progress</h3>
            <div class="progress-bar">
                {% set current_progress = (question_number / total_questions * 100) | round(0) %}
                <div class="progress-fill" style="width: {{ current_progress }}%"></div>
            </div>
            <div class="progress-text">
                <span>Progress: Question {{ question_number }} of {{ total_questions }}</span>
                <span class="progress-percentage">{{ current_progress }}%</span>
            </div>
            <div class="step-indicator">
                {% for i in range(1, total_questions + 1) %}
                    <div class="step {% if i < question_number %}completed{% elif i == question_number %}active{% endif %}">
                        <div class="step-circle">{{ i }}</div>
                    </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="score-tracker">
            <div class="score-item">
                <div class="score-label">You</div>
                <div class="score-value">{{ session_data.user_score }}</div>
            </div>
            <div class="score-item">
                <div class="score-label">AI Bot</div>
                <div class="score-value">{{ session_data.ai_score }}</div>
            </div>
        </div>
        {% endif %}
        
        {% if show_result %}
            <!-- Results View -->
            <div class="bot-result-container">
                <div class="question-card">
                    <h3>Question {{ question_number|default(1) }}</h3>
                    <p class="question-text">{{ previous_question.question_text }}</p>
                    
                    <div class="user-answer-section {% if is_user_correct %}correct{% else %}incorrect{% endif %}">
                        <h4>Your Answer: {{ user_answer }}</h4>
                        <p>
                            {% if user_answer == 'A' %}{{ previous_question.option_a }}
                            {% elif user_answer == 'B' %}{{ previous_question.option_b }}
                            {% elif user_answer == 'C' %}{{ previous_question.option_c }}
                            {% elif user_answer == 'D' %}{{ previous_question.option_d }}
                            {% endif %}
                        </p>
                        <span class="{% if is_user_correct %}correct-badge{% else %}incorrect-badge{% endif %}">
                            {% if is_user_correct %}✓ Correct{% else %}✗ Incorrect{% endif %}
                        </span>
                    </div>
                    
                    <div class="vs-indicator">VS</div>
                    
                    <div class="ai-answer-section {% if is_ai_correct %}correct{% else %}incorrect{% endif %}">
                        <h4>AI Answer: {{ ai_answer }}</h4>
                        <p>
                            {% if ai_answer == 'A' %}{{ previous_question.option_a }}
                            {% elif ai_answer == 'B' %}{{ previous_question.option_b }}
                            {% elif ai_answer == 'C' %}{{ previous_question.option_c }}
                            {% elif ai_answer == 'D' %}{{ previous_question.option_d }}
                            {% endif %}
                        </p>
                        <span class="{% if is_ai_correct %}correct-badge{% else %}incorrect-badge{% endif %}">
                            {% if is_ai_correct %}✓ Correct{% else %}✗ Incorrect{% endif %}
                        </span>
                    </div>
                    
                    <div class="answer-details">
                        <div class="answer-item">
                            <strong>Correct Answer:</strong> 
                            <span class="correct-text">
                                {{ previous_question.correct_answer }} - 
                                {% if previous_question.correct_answer == 'A' %}{{ previous_question.option_a }}
                                {% elif previous_question.correct_answer == 'B' %}{{ previous_question.option_b }}
                                {% elif previous_question.correct_answer == 'C' %}{{ previous_question.option_c }}
                                {% elif previous_question.correct_answer == 'D' %}{{ previous_question.option_d }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    
                    <div class="explanation">
                        <strong>Explanation:</strong>
                        <p>{{ previous_question.explanation }}</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <form method="POST" action="{{ url_for('continue_bot_session') }}">
                        <button type="submit" class="btn btn-primary btn-large">Continue to Next Question</button>
                    </form>
                </div>
                
                {% if question %}
<form method="POST" action="{{ url_for('submit_bot_answer') }}" id="nextAnswerForm">
                        <input type="hidden" name="question_id" value="{{ question.id }}">
                        
                        <div class="options">
                            <label class="option-label">
                                <input type="radio" name="answer" value="A" required>
                                <span>A) {{ question.option_a }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="B" required>
                                <span>B) {{ question.option_b }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="C" required>
                                <span>C) {{ question.option_c }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="D" required>
                                <span>D) {{ question.option_d }}</span>
                            </label>
                        </div>
                        
                        <div class="submit-container">
                            <button type="submit" class="btn btn-primary btn-large" id="nextSubmitBtn">Submit Answer</button>
                        </div>
                    </form>
                </div>
                {% endif %}
            </div>
        {% else %}
            <!-- Question Form -->
            <div class="bot-question-container">
<div class="question-card">
                    <h3>Question {{ question_number|default(1) }}{% if total_questions %} of {{ total_questions }}{% endif %}</h3>
                    <p class="question-text">{{ question.question_text }}</p>
                    
                    {% if ai_answer is defined and show_result %}
                    <div class="ai-answer-preview">
                        <h4>AI Answer: {{ ai_answer }})</h4>
                        <p class="answer-text">
                            {% if ai_answer == 'A' %}{{ question.option_a }}
                            {% elif ai_answer == 'B' %}{{ question.option_b }}
                            {% elif ai_answer == 'C' %}{{ question.option_c }}
                            {% elif ai_answer == 'D' %}{{ question.option_d }}
                            {% endif %}
                        </p>
                        <span class="{% if is_ai_correct %}correct-badge{% else %}incorrect-badge{% endif %}">
                            {% if is_ai_correct %}✓ Correct{% else %}✗ Incorrect{% endif %}
                        </span>
                    </div>
                    {% endif %}
                     
                    <form method="POST" action="{{ url_for('submit_bot_answer') }}" id="answerForm">
                        <input type="hidden" name="question_id" value="{{ question.id }}">
                        
                        <div class="options">
                            <label class="option-label">
                                <input type="radio" name="answer" value="A" required>
                                <span>A) {{ question.option_a }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="B" required>
                                <span>B) {{ question.option_b }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="C" required>
                                <span>C) {{ question.option_c }}</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="answer" value="D" required>
                                <span>D) {{ question.option_d }}</span>
                            </label>
                        </div>
                        
                        <div class="submit-container">
                            <button type="submit" class="btn btn-primary btn-large" id="submitBtn">Submit Answer</button>
                        </div>
                    </form>
                </div>
            </div>
        {% endif %}
    </div>
    
    <script>
        // Loading states for form submissions
        const forms = ['answerForm', 'nextAnswerForm'];
        const submitBtns = ['submitBtn', 'nextSubmitBtn'];
        
        forms.forEach((formId, index) => {
            const form = document.getElementById(formId);
            const btn = document.getElementById(submitBtns[index]);
            
            if (form && btn) {
                form.addEventListener('submit', function(e) {
                    btn.classList.add('btn-loading');
                    btn.disabled = true;
                    
                    // Animate the question card
                    const questionCard = form.closest('.question-card');
                    questionCard.style.opacity = '0.7';
                });
            }
        });
        
        // Enhanced radio button interactions
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Remove previous selections
                document.querySelectorAll('.option-label').forEach(label => {
                    label.style.background = '#f7fafc';
                    label.style.borderColor = '#e2e8f0';
                });
                
                // Highlight selected option
                const selectedLabel = this.closest('.option-label');
                selectedLabel.style.background = 'var(--warm-beige)';
                selectedLabel.style.borderColor = 'var(--primary-walnut)';
            });
        });
        
        // Animate progress bar on load
        window.addEventListener('load', function() {
            const progressFill = document.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.transition = 'width 1s ease-in-out';
            }
        });
    </script>
</body>
</html>
